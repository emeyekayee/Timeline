// Generated by CoffeeScript 1.4.0
(function() {

  this.TimePix = (function() {

    function TimePix() {
      null;
    }

    TimePix.baseTime = 0;

    TimePix.timeWindow = 3 * 3600;

    TimePix.tlo = null;

    TimePix.thi = null;

    TimePix.meta = {};

    TimePix.merge_metadata = function(data) {
      this.meta = data.meta;
      TimePix.baseTime || (TimePix.baseTime = this.meta['minTime'] - TimePix.timeWindow * 8);
      TimePix.tlo = TimePix.tlo && Math.min(TimePix.tlo, this.meta.t1) || this.meta.t1;
      TimePix.thi = TimePix.thi && Math.max(TimePix.thi, this.meta.t2) || this.meta.t2;
      return this.inc = this.meta.inc;
    };

    TimePix.ux_time_now = function() {
      return new Date().valueOf() / 1000;
    };

    TimePix.ux_time_offset = function(uxt) {
      return uxt - this.baseTime;
    };

    TimePix.ux_time_offset_pix = function(uxt) {
      return UseBlock.secs_to_pix_scale(this.ux_time_offset(uxt));
    };

    TimePix.scroll_to_ux_time = function(uxt) {
      var sc;
      sc = $('#scrolling-container');
      return sc.scrollLeft(this.ux_time_offset_pix(uxt));
    };

    TimePix.scroll_to_thi = function() {
      return this.scroll_to_ux_time(this.thi - this.timeWindow);
    };

    TimePix.ux_time_of_pix = function(x) {
      return UseBlock.pix_to_secs(x);
    };

    TimePix.scroll_to_tlo = function() {
      return TimePix.scroll_to_ux_time(TimePix.tlo);
    };

    TimePix.set_time_cursor = function() {
      var cursor, now_offset;
      cursor = $('#current-time-cursor');
      now_offset = TimePix.ux_time_offset_pix(TimePix.ux_time_now());
      cursor.css('left', now_offset + 'px');
      return setTimeout(TimePix.set_time_cursor, 15 * 1000);
    };

    TimePix.scroll_monitor = function() {
      var l_vis_time, r_vis_time, sc;
      sc = $('#scrolling-container');
      l_vis_time = UseBlock.pix_to_secs(sc.scrollLeft());
      r_vis_time = l_vis_time + TimePix.timeWindow;
      if (r_vis_time > TimePix.thi) {
        RsrcListCtrlScope.$apply(RsrcListCtrlScope.more_data);
      } else if (l_vis_time < TimePix.tlo) {
        RsrcListCtrlScope.$apply(RsrcListCtrlScope.less_data);
      }
      return setTimeout(TimePix.scroll_monitor, 100);
    };

    return TimePix;

  }).call(this);

}).call(this);
