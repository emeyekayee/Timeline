<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>get_all_blocks (Program)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File app/models/program.rb, line 21</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Program</span>.<span class="ruby-identifier">get_all_blocks</span>( <span class="ruby-identifier">rIds</span>, <span class="ruby-identifier">t1</span>, <span class="ruby-identifier">t2</span> )
    <span class="ruby-identifier">chanids</span> = <span class="ruby-identifier">rIds</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">rId</span><span class="ruby-operator">|</span> <span class="ruby-constant">Channel</span>.<span class="ruby-identifier">find_as_schedule_resource</span>(<span class="ruby-identifier">rId</span>).<span class="ruby-identifier">chanid</span> }
    
    <span class="ruby-identifier">conds</span> = [ <span class="ruby-value str">&quot;(endtime   &gt; ?) AND &quot;</span> <span class="ruby-operator">+</span>
              <span class="ruby-value str">&quot;(starttime &lt; ?) AND &quot;</span> <span class="ruby-operator">+</span>
              <span class="ruby-value str">&quot;(chanid IN (?))&quot;</span>,
              <span class="ruby-identifier">t1</span>,
              <span class="ruby-identifier">t2</span>,
              <span class="ruby-identifier">chanids</span> ] 

    <span class="ruby-identifier">opts</span> = { <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@@program_attrs</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conds</span>, 
             <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;chanid MOD 1000, starttime&quot;</span>}
    
    <span class="ruby-identifier">blks</span> = <span class="ruby-constant">Program</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">opts</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pgm</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pgm</span>.<span class="ruby-identifier">set_visual_info</span> }

    <span class="ruby-identifier">blks</span>.<span class="ruby-identifier">group_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">pgm</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pgm</span>.<span class="ruby-identifier">channel</span>.<span class="ruby-identifier">channum</span> }
  <span class="ruby-keyword kw">end</span></pre>
</body>
</html>